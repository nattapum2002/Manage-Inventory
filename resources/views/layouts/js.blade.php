<script src="https://cdn.ckeditor.com/ckeditor5/23.0.0/classic/ckeditor.js"></script>

<!-- jQuery -->
<script src="{{ asset('backend/plugins/jquery/jquery.min.js') }}"></script>
<!-- Bootstrap 4 -->
<script src="{{ asset('backend/plugins/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
<!-- DataTables  & Plugins -->
{{-- <script src="{{ asset('backend/plugins/datatables/jquery.dataTables.min.js') }}"></script>
<script src="{{ asset('backend/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js') }}"></script>
<script src="{{ asset('backend/plugins/datatables-responsive/js/dataTables.responsive.min.js') }}"></script>
<script src="{{ asset('backend/plugins/datatables-responsive/js/responsive.bootstrap4.min.js') }}"></script>
<script src="{{ asset('backend/plugins/datatables-buttons/js/dataTables.buttons.min.js') }}"></script>
<script src="{{ asset('backend/plugins/datatables-buttons/js/buttons.bootstrap4.min.js') }}"></script>
<script src="{{ asset('backend/plugins/jszip/jszip.min.js') }}"></script>
<script src="{{ asset('backend/plugins/pdfmake/pdfmake.min.js') }}"></script>
<script src="{{ asset('backend/plugins/pdfmake/vfs_fonts.js') }}"></script>
<script src="{{ asset('backend/plugins/datatables-buttons/js/buttons.html5.min.js') }}"></script>
<script src="{{ asset('backend/plugins/datatables-buttons/js/buttons.print.min.js') }}"></script>
<script src="{{ asset('backend/plugins/datatables-buttons/js/buttons.colVis.min.js') }}"></script> --}}
<!-- CodeMirror -->
<script src="{{ asset('backend/plugins/codemirror/codemirror.js') }}"></script>
<script src="{{ asset('backend/plugins/codemirror/mode/css/css.js') }}"></script>
<script src="{{ asset('backend/plugins/codemirror/mode/xml/xml.js') }}"></script>
<script src="{{ asset('backend/plugins/codemirror/mode/htmlmixed/htmlmixed.js') }}"></script>
<!-- Summernote -->
<script src="{{ asset('backend/plugins/summernote/summernote-bs4.min.js') }}"></script>
<!-- AdminLTE App -->
<script src="{{ asset('backend/dist/js/adminlte.min.js') }}"></script>
<!-- Select2 -->
<script src="{{ asset('backend/plugins/select2/js/select2.full.min.js') }}"></script>
<!-- Bootstrap4 Duallistbox -->
<script src="{{ asset('backend/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js') }}"></script>
<!-- InputMask -->
<script src="{{ asset('backend/plugins/moment/moment.min.js') }}"></script>
<script src="{{ asset('backend/plugins/inputmask/jquery.inputmask.min.js') }}"></script>
<!-- date-range-picker -->
<script src="{{ asset('backend/plugins/daterangepicker/daterangepicker.js') }}"></script>
<!-- bootstrap color picker -->
<script src="{{ asset('backend/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js') }}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="{{ asset('backend/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js') }}"></script>
<!-- Bootstrap Switch -->
<script src="{{ asset('backend/plugins/bootstrap-switch/js/bootstrap-switch.min.js') }}"></script>
<!-- BS-Stepper -->
<script src="{{ asset('backend/plugins/bs-stepper/js/bs-stepper.min.js') }}"></script>
<!-- dropzonejs -->
<script src="{{ asset('backend/plugins/dropzone/min/dropzone.min.js') }}"></script>

{{-- <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous">
</script> --}}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script
    src="https://cdn.datatables.net/v/bs5/jszip-3.10.1/dt-2.1.8/af-2.7.0/b-3.1.2/b-colvis-3.1.2/b-html5-3.1.2/b-print-3.1.2/cr-2.0.4/date-1.5.4/fc-5.0.4/fh-4.0.1/kt-2.12.1/r-3.0.3/rg-1.5.0/rr-1.5.0/sc-2.4.3/sb-1.8.1/sp-2.3.3/sl-2.1.0/sr-1.4.1/datatables.min.js">
</script>
{{-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> --}}
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

<!-- chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.cjs"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.cjs.map"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.js.map"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js.map"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

<script>
    // ฟังก์ชันสำหรับการเพิ่ม item และเรียกใช้งาน autocomplete
    let item_count = 1;

    $('#add-item').click(function() {
        item_count++;

        $('#item-row').append(`
        <div class="row" id="item-${item_count}">
            <div class="col">
                <label for="item_id_${item_count}" class="form-label">${item_count} รหัสสินค้า</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="item_id_${item_count}" name="item_id[${item_count}]" readonly>
                </div>
            </div>
            <div class="col">
                <label for="item_name_${item_count}" class="form-label">ชื่อสินค้า</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="item_name_${item_count}" name="item_name[${item_count}]">
                </div>
            </div>
            <div class="col">
                <label for="item_amount_${item_count}" class="form-label">จำนวน</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="item_amount_${item_count}" name="item_amount[${item_count}]">
                </div>
            </div>
            <div class="col">
                <label for="item_weight_${item_count}" class="form-label">น้ำหนัก(KG.)</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="item_weight_${item_count}" name="item_weight[${item_count}]">
                </div>
            </div>
            <div class="col">
                <label for="item_comment_${item_count}" class="form-label">หมายเหตุ</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="item_comment_${item_count}" name="item_comment[${item_count}]">
                </div>
            </div>
            <div class="col">
                <label for="remove-item" class="form-label">จัดการ</label>
                <div class="input-group text-center">
                    <button type="button" class="btn btn-danger remove-item">ลบ</button>
                </div>
            </div>
        </div>
    `);

        // เรียกใช้งาน autocomplete กับฟิลด์ที่เพิ่มใหม่
        initializeAutocomplete(`#item_name_${item_count}`, `#item_id_${item_count}`);
    });

    // ฟังก์ชัน autocomplete
    function initializeAutocomplete(nameSelector, idSelector) {
        $(nameSelector).autocomplete({
            source: function(request, response) {
                $.ajax({
                    url: "{{ route('autocomplete') }}",
                    data: {
                        query: request.term
                    },
                    success: function(data) {
                        response(data); // ส่งข้อมูลผลลัพธ์ไปยัง autocomplete
                    }
                });
            },
            minLength: 0, // เริ่มค้นหาหลังจากพิมพ์ไป 2 ตัวอักษร
            select: function(event, ui) {
                // เมื่อเลือกสินค้า ให้เติมรหัสสินค้าในฟิลด์ item_id
                $(idSelector).val(ui.item.id); // เติมรหัสสินค้าในช่องรหัสสินค้า
                $(nameSelector).val(ui.item.value); // เติมชื่อสินค้าในช่องชื่อสินค้า
            }
        });

        $(nameSelector).focus(function() {
            $(this).autocomplete('search', ''); // ส่งค่าว่างเพื่อแสดง autocomplete ทันที
        });
    }
    initializeAutocomplete('#item_name_1', '#item_id_1');

    // ฟังก์ชันสำหรับลบแถว
    $(document).on('click', '.remove-item', function() {
        item_count--;
        $(this).closest('[id^="item-"]').remove();
    });
</script>
{{-- สคริปต์ SlipDetail --}}
<script>
    $(document).ready(function() {
        let fields = ['department', 'amount', 'weight', 'comment'];

        function hideEdit(edit_slip_productId) {
            fields.forEach(function(field) {
                $('#' + field + '_' + edit_slip_productId).show();
                $('#edit_' + field + '_' + edit_slip_productId).hide();
            });

            // เปลี่ยนปุ่ม "บันทึก" กลับเป็น "แก้ไข"
            $('.save_btn').text('แก้ไข').removeClass('btn-success')
                .addClass('btn-primary').removeClass('save_btn').addClass('edit_slip');
            $('#cancel_edit_' + edit_slip_productId).hide();
        }

        $(document).on('click', '.edit_slip', function() {
            let edit_slip_productId = $(this).data('product-id'); // รับค่า product_id จากปุ่ม
            let edit_slip_productCode = $(this).data('product-code');
            fields.forEach(function(field) {
                $('#' + field + '_' + edit_slip_productId).hide();
                $('#edit_' + field + '_' + edit_slip_productId).show();
            });

            $('#cancel_edit_' + edit_slip_productId).show();
            // เปลี่ยนปุ่ม "แก้ไข" เป็น "บันทึก"
            $(this).text('บันทึก').removeClass('btn-primary').addClass('btn-success')
                .removeClass('edit_slip').addClass('save_btn').attr('type', 'button');
            $('#cancel_edit_' + edit_slip_productId).click(function() {
                hideEdit(edit_slip_productId);
            });

        });

        // Handle saving data when clicking the "บันทึก" button
        $(document).on('click', '.save_btn', function() {
            let edit_slip_productId = $(this).data('product-id');
            let data_slip = {};
            let edit_slip_productCode = $(this).data('product-code');

            // รับค่าที่แก้ไขจาก input
            $.each(fields, function(index, field) {
                data_slip[field] = $('#edit_' + field + '_' + edit_slip_productId).val();
            });

            // ส่งข้อมูลไปยังเซิร์ฟเวอร์ (Ajax)
            $.ajax({
                url: "{{ route('EditSlip') }}", // ตัวอย่าง URL สำหรับการอัปเดตข้อมูล
                method: "POST",
                dataType: "json",
                data: {
                    _token: '{{ csrf_token() }}',
                    product_id: edit_slip_productId,
                    product_edit: data_slip,
                    product_code: edit_slip_productCode
                },

                success: function(response) {
                    // อัปเดตข้อมูลใหม่ในตาราง
                    fields.forEach(function(field) {
                        $('#' + field + '_' + edit_slip_productId).text(data_slip[
                            field]);
                    });
                    console.log(response);
                    // ซ่อน input และแสดงค่าใหม่
                    hideEdit(edit_slip_productId);
                    alert('บันทึกข้อมูลสําเร็จ');
                },
                error: function(xhr, status, error) {
                    alert('มีข้อผิดพลาดในการบันทึกข้อมูล');
                    console.log(xhr.responseText);
                }
            });
        });
    });
</script>
{{-- สคริปต์ SlipDetail --}}

<script>
    var user_count = 1;

    $('#add-user').click(function() {
        user_count++;
        $('#add-user-shift').append(`
            <div class="row" id="user-${user_count}">
                <div class="col-11">
                    <div class="row">
                        <div class="col-lg-3 col-md-6 col-sm-12">
                            <div class="form-group">
                                <label for="user_id[${user_count}]" class="form-label">รหัสพนักงาน</label>
                                <input type="text" class="form-control" id="user_id${user_count}" name="user_id[${user_count}]" readonly>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-12">
                            <div class="form-group">
                                <label for="name[${user_count}]" class="form-label">ชื่อ</label>
                                <input type="text" class="form-control" id="name${user_count}" name="name[${user_count}]">
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-12">
                            <div class="form-group">
                                <label for="surname[${user_count}]" class="form-label">นามสกุล</label>
                                <input type="text" class="form-control" id="surname${user_count}" name="surname[${user_count}]" disabled>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-12">
                            <div class="form-group">
                                <label for="position[${user_count}]" class="form-label">ตำแหน่ง</label>
                                <input type="text" class="form-control" id="position${user_count}" name="position[${user_count}]" disabled>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-1">
                        <label for="remove-user" class="form-label">#</label>
                    <div class="form-group">
                        <button type="button" class="btn btn-danger remove-user">ลบ</button>
                    </div>
                </div>
            </div>
        `);
        // เรียกใช้งาน autocomplete กับฟิลด์ที่เพิ่มใหม่
        initializeShiftAutocomplete(`#name${user_count}`, `#user_id${user_count}`, `#surname${user_count}`,
            `#position${user_count}`);
    });

    // ฟังก์ชันสำหรับลบแถว
    $(document).on('click', '.remove-user', function() {
        $(this).closest('[id^="user-"]').remove();
    });

    // ฟังก์ชันสำหรับ autocomplete
    function initializeShiftAutocomplete(nameSelector, idSelector, surnameSelector, positionSelector) {
        $(nameSelector).autocomplete({
            source: function(request, response) {
                $.ajax({
                    url: "{{ route('AutoCompleteAddShift') }}",
                    data: {
                        query: request.term
                    },
                    success: function(data) {
                        console.log(data);
                        response(data); // ส่งข้อมูลผลลัพธ์ไปยัง autocomplete
                    }
                });
            },
            minLength: 0, // เริ่มค้นหาหลังจากพิมพ์ไป 2 ตัวอักษร
            select: function(event, ui) {
                // เมื่อเลือกสินค้า ให้เติมรหัสสินค้าในฟิลด์ item_id
                $(idSelector).val(ui.item.user_id); // เติมรหัสสินค้าในช่องรหัสสินค้า
                $(nameSelector).val(ui.item.name); // เติมชื่อสินค้าในช่องชื่อสินค้า
                $(surnameSelector).val(ui.item.surname);
                $(positionSelector).val(ui.item.position);
            }
        });

        $(nameSelector).focus(function() {
            $(this).autocomplete('search', ''); // ส่งค่าว่างเพื่อแสดง autocomplete ทันที
        });
    }
    initializeShiftAutocomplete(`#name0`, `#user_id0`, `#surname0`, `#position0`);
</script>
<script>
    $(document).ready(function() {
        let fields = ['user_id', 'name', 'surname', 'position'];

        function hideEdit(edit_shift_productId) {
            fields.forEach(function(field) {
                $('#span_shift_' + field + '_' + edit_shift_productId).show();
                $('#edit_shift_' + field + '_' + edit_shift_productId).hide();
            });
            $('.save_shift_btn').text('แก้ไข').removeClass('btn-success')
                .addClass('btn-primary').removeClass('save_shift_btn').addClass('edit_shift');
            $('#cancel_edit_shift_' + edit_shift_productId).hide();
        }

        $(document).on('click', '.edit_shift', function() {
            let edit_shift_productId = $(this).data('shift-id');
            fields.forEach(function(field) {
                $('#span_shift_' + field + '_' + edit_shift_productId).hide();
                $('#edit_shift_' + field + '_' + edit_shift_productId).show();
            });
            $('#cancel_edit_shift_' + edit_shift_productId).show();
            $(this).text('บันทึก').removeClass('btn-primary').addClass('btn-success')
                .removeClass('edit_shift').addClass('save_shift_btn').attr('type', 'button');

            $('#cancel_edit_shift_' + edit_shift_productId).click(function() {
                hideEdit(edit_shift_productId);
            });

            // Initialize autocomplete for each field when edit mode is activated
            initializeEditShiftAutocomplete('#edit_shift_name_' + edit_shift_productId,
                '#edit_shift_user_id_' +
                edit_shift_productId, '#edit_shift_surname_' + edit_shift_productId,
                '#edit_shift_position_' + edit_shift_productId);
        });

        $(document).on('click', '.save_shift_btn', function() {
            let edit_shift_productId = $(this).data('shift-id');
            let data_shift = {};

            $.each(fields, function(index, field) {
                data_shift[field] = $('#edit_shift_' + field + '_' + edit_shift_productId)
                    .val();
            });

            $.ajax({
                url: "{{ route('SaveEditShift') }}",
                method: "POST",
                dataType: "json",
                data: {
                    _token: '{{ csrf_token() }}',
                    shift_id: edit_shift_productId,
                    shift_edit: data_shift,
                },
                success: function(response) {
                    fields.forEach(function(field) {
                        $('#span_shift_' + field + '_' + edit_shift_productId).text(
                            data_shift[field]);
                    });
                    hideEdit(edit_shift_productId);
                    alert('บันทึกข้อมูลสำเร็จ');
                    console.log(response);
                },
                error: function(xhr, status, error) {
                    alert('มีข้อผิดพลาดในการบันทึกข้อมูล');
                    console.log(xhr);
                }
            });
        });
    });

    function initializeEditShiftAutocomplete(nameSelector, idSelector, surnameSelector, positionSelector) {
        $(nameSelector).autocomplete({
            source: function(request, response) {
                $.ajax({
                    url: "{{ route('AutoCompleteAddShift') }}",
                    data: {
                        query: request.term
                    },
                    success: function(data) {
                        response(data);
                    }
                });
            },
            minLength: 0,
            select: function(event, ui) {
                $(idSelector).val(ui.item.user_id);
                $(nameSelector).val(ui.item.name);
                $(surnameSelector).val(ui.item.surname);
                $(positionSelector).val(ui.item.position);
            }
        });

        $(nameSelector).focus(function() {
            $(this).autocomplete('search', '');
        });
    }
</script>


<script>
    $(document).ready(function() {
        $('#stock-all-table').DataTable({
            info: false,
            ordering: true,
            paging: true
        });
        $('#stock_per_date').DataTable({
            info: false,
            ordering: false,
            paging: true
        });
        $('#slip_per_date').DataTable({
            info: false,
            ordering: true,
            paging: true
        });
        $('#item_per_slip').DataTable({
            info: false,
            ordering: false,
            paging: true,
            layout: {
                topStart: {
                    buttons: [
                        'copy', 'excel', 'pdf'
                    ]
                }
            }
        });
        $('#queue-all-table').DataTable({
            info: false,
            ordering: true,
            paging: true
        })
    });
</script>
<script>
    $(function() {
        $("#userstable").DataTable({
            info: true,
            ordering: true,
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            paging: true,
            // scrollX: true,
            layout: {
                topStart: {
                    buttons: [
                        'copy', 'excel', 'pdf'
                    ]
                }
            }
        });
        $("#product_storetable").DataTable({
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            // scrollX: true,
            // layout: {
            //     topStart: {
            //         buttons: [
            //             'copy', 'excel', 'pdf'
            //         ]
            //     }
            // }
        });
        $("#stocktable").DataTable({
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            // scrollX: true,
            layout: {
                topStart: {
                    buttons: [
                        'copy', 'excel', 'pdf'
                    ]
                }
            }
        });
        $("#customer_ordertable").DataTable({
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            // scrollX: true,
            // layout: {
            //     topStart: {
            //         buttons: [
            //             'copy', 'excel', 'pdf'
            //         ]
            //     }
            // }
        });
        $("#detail_customer_ordertable").DataTable({
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            // scrollX: true,
            layout: {
                topStart: {
                    buttons: [
                        'copy', 'excel', 'pdf'
                    ]
                }
            }
        });
        $("#pallettable").DataTable({
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            // scrollX: true,
            // layout: {
            //     topStart: {
            //         buttons: [
            //             'copy', 'excel', 'pdf'
            //         ]
            //     }
            // }
        });
        $("#DetailPallettable").DataTable({
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            // scrollX: true,
            layout: {
                topStart: {
                    buttons: [
                        'copy', 'excel', 'pdf'
                    ]
                }
            }
        });
        $("#CustomerQueuetable").DataTable({
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            // scrollX: true,
            layout: {
                topStart: {
                    buttons: [
                        'copy', 'excel', 'pdf'
                    ]
                }
            }
        });
        $("#Shifttable").DataTable({
            responsive: true,
            lengthChange: true,
            autoWidth: true,
            // scrollX: true,
            layout: {
                topStart: {
                    buttons: [
                        'copy', 'excel', 'pdf'
                    ]
                }
            }
        });
    });
</script>
